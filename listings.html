<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Listings - Homes by Homies</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo">Homes by Homies</div>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="findroommate.html">Find Roommate</a>
        <a href="add-property.html">Add Property</a>
      </nav>
    </header>

    <h2>All Listings</h2>

    <div class="card">
      <div class="search-row">
        <input id="q" class="input" placeholder="Search title or description">
        <input id="location" class="input" placeholder="Location">
        <input id="min" class="input" placeholder="Min price" type="number">
        <input id="max" class="input" placeholder="Max price" type="number">
        <button id="searchBtn" class="btn">Search</button>
      </div>
    </div>

    <div id="listings" class="grid" style="margin-top:12px"></div>

    <footer><small>Homes by Homies</small></footer>
  </div>

  <script type="module">
    import { fetchProperties } from './js/app.js';

    const el = document.getElementById('listings');
    const searchBtn = document.getElementById('searchBtn');

    async function load(q = {}) {
      el.innerHTML = '<div class="card small">Loading...</div>';
      const rows = await fetchProperties(q);
      if (!rows || rows.length === 0) {
        el.innerHTML = '<div class="card small">No results</div>';
        return;
      }
      el.innerHTML = rows.map(p => `
        <a class="card linkless" href="property.html?id=${p.id}">
          <div class="featured"><img src="${p.image_url || 'https://via.placeholder.com/400x300?text=Home'}"></div>
          <h3>${p.title}</h3>
          <div class="meta">${p.location || '—'} • ₹${p.price}</div>
          <p class="small">${(p.description||'').slice(0,120)}</p>
        </a>
      `).join('');
    }

    searchBtn.addEventListener('click', () => {
      const q = document.getElementById('q').value;
      const location = document.getElementById('location').value;
      const minPrice = document.getElementById('min').value;
      const maxPrice = document.getElementById('max').value;
      load({ q, location, minPrice, maxPrice });
    });

    load();
  </script>
</body>
</html>
